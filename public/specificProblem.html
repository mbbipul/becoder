<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" href="assets/images/becoder.png" type="image/gif" sizes="16x16">
  <title>becoder</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
  <!-- Bootstrap core CSS -->
  <link href="assets/library/mdb/css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="assets/library/mdb/css/mdb.min.css" rel="stylesheet">
  <link href="assets/css/becoder.css" rel="stylesheet">

  <!-- JQuery -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="assets/library/mdb/js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="assets/library/mdb/js/mdb.min.js"></script>

<!--  firebase config-->
    <script src="/__/firebase/5.6.0/firebase-app.js"></script>
    <script src="/__/firebase/5.6.0/firebase-auth.js"></script>
    <script src="/__/firebase/5.6.0/firebase-firestore.js"></script>
    <script src="/__/firebase/5.6.0/firebase-storage.js"></script>
    <script src="/__/firebase/5.6.0/firebase-messaging.js"></script>
    <!--  firebase config-->
<script src="/__/firebase/init.js"></script>


</head>
    <body class="grey lighten-3">

  <!--Main Navigation-->
  <header>
    <!--Navbar-->
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-blue scrolling-navbar">
      <a class="navbar-brand" href="index.html">
        <img src="assets/images/becoder.png" width="30" height="30" class="d-inline-block align-top" alt="">
      </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#becoderNavbarToggle" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="becoderNavbarToggle">
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
              <li class="nav-item active">
                <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Practice</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="contests.html">Contests</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Resource</a>
              </li>
              <li class="nav-item" style="padding-right:20px;padding-left:20px">

              </li>

            </ul>
            <ul class="navbar-nav ml-auto">
              <li class="nav-item">
                <a class="nav-link" href="#">Leaderboard</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Notifications</a>
              </li>

              <li class="nav-item" id="navbar-login-signin-button" hidden>
                <a class="nav-link" data-toggle="modal" data-target="#modalLRForm" href="#">Login/Register</a>
              </li>

              <li class="nav-item dropdown" id="navbar-user-item" hidden>
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <img id="nav-user-pic" width="30" height="30" class="d-inline-block align-top" alt="">
                  <span id="nav-user-name">becoder</span></a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="#">Ranking</a>
                  <a class="dropdown-item" href="userProfile.html">Profile</a>
                  <a class="dropdown-item" href="#">Submission</a>
                  <a class="dropdown-item" href="#">Note</a>
                  <a class="dropdown-item" href="#">Setting</a>
                  <a class="dropdown-item" href="administration/contests.html">Administration</a>
                  <a class="dropdown-item" id="logout" href="#">Logout</a>

                </div>
              </li>
            </ul>
          </div>
        </nav>
    <!--/.Navbar-->

    </header>


    <!--Modal: Login / Register Form-->
  <div class="modal fade" id="modalLRForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog cascading-modal" role="document">
    <!--Content-->
    <div class="modal-content">

      <!--Modal cascading tabs-->
      <div class="modal-c-tabs">

        <!-- Nav tabs -->
        <ul class="nav nav-tabs md-tabs tabs-2 light-blue darken-3" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#panel7" role="tab"><i class="fas fa-user mr-1"></i>
              Login</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#panel8" role="tab"><i class="fas fa-user-plus mr-1"></i>
              Register</a>
          </li>
        </ul>

        <!-- Tab panels -->
        <div class="tab-content">
          <!--Panel 7-->
          <div class="tab-pane fade in show active" id="panel7" role="tabpanel">

            <!--Body-->
            <div class="modal-body mb-1">
              <div class="md-form form-sm mb-5">
                <i class="fas fa-envelope prefix"></i>
                <input type="email" placeholder="email or username" id="user-sign-in-email" class="form-control form-control-sm validate">
              </div>

              <div class="md-form form-sm mb-4">
                <i class="fas fa-lock prefix"></i>
                <input type="password" placeholder="password" id="user-sign-in-password" class="form-control form-control-sm validate">
              </div>
              <div class="text-center mt-2">
                <button class="btn btn-info"  id= "sign-in-with-email" >Log in <i class="fas fa-sign-in ml-1"></i></button>
              </div>
            </div>
            <!--Footer-->
            <div class="login_connect_with">
                Or Connect With
              </div>
            <!--Footer-->
            <div class="modal-footer">
              <div class="social">
                <a class="circle github" href="#">
                    <i class="fab fa-github"></i>
                </a>
                <a id="google_login" class="circle google" href="#">
                    <i class="fab fa-google"></i>
                </a>
                <a id="facebook_login" class="circle facebook" href="#">
                    <i class="fab fa-facebook-f"></i>
                </a>
            </div>
            </div>

          </div>
          <!--/.Panel 7-->

          <!--Panel 8-->
          <div class="tab-pane fade" id="panel8" role="tabpanel">

            <!--Body-->
            <div class="modal-body">
              <div class="md-form form-sm mb-5">
                <i class="fas fa-envelope prefix"></i>
                <input type="email" placeholder="email" id="user-sign-up-email" class="form-control form-control-sm validate">

              </div>
              <div class="md-form form-sm mb-5">
                <i class="fas fa-user prefix"></i>
                <input type="text" placeholder="username" id="user-sign-up-username" class="form-control form-control-sm validate">

              </div>
              <div class="md-form form-sm mb-5">
                <i class="fas fa-lock prefix"></i>
                <input type="password" placeholder="password" id="user-sign-up-password" class="form-control form-control-sm validate">

              </div>

              <div class="md-form form-sm mb-4">
                <i class="fas fa-lock prefix"></i>
                <input type="password" placeholder="Repeat password" id="modalLRInput14" class="form-control form-control-sm validate">
              </div>
            <div class="custom-control custom-checkbox">
                <input type="checkbox" class="custom-control-input" id="defaultUnchecked">
                <label class="custom-control-label" for="defaultUnchecked">Accept the<a href="#" class="green-text font-weight-bold">
                              Terms and Conditions</a></label>
            </div>
              <div class="text-center form-sm mt-2">
                <button class="btn btn-info" id="sign-up-with-email">Sign up <i class="fas fa-sign-in ml-1"></i></button>
              </div>

            </div>
              <div class="login_connect_with">
                Or Connect With
              </div>
            <!--Footer-->
            <div class="modal-footer">
              <div class="social">
                <a class="circle github" href="#">
                    <i class="fab fa-github"></i>
                </a>
                <a id="google_login" class="circle google" href="#">
                    <i class="fab fa-google"></i>
                </a>
                <a id="facebook_login" class="circle facebook" href="#">
                    <i class="fab fa-facebook-f"></i>
                </a>
            </div>
            </div>
          </div>
          <!--/.Panel 8-->
        </div>

      </div>
    </div>
    <!--/.Content-->
  </div>
</div>
<!--Modal: Login / Register Form-->
<div >


  <!--Grid row-->
  <!--Section: Post-->
  <!--Main layout-->

  <main style="margin-top: 70px;">
        <!--Main Navigation-->
  <div hidden class="row wow fadeIn" id="sign-in-sign-up-jumbotron" data-wow-delay="0.2s">
    <div class="col-md-12">
      <div class="jumbotron">
        <h2 class="h2-responsive">Learn to be a Coder</h2>
        <br>
        <p>In communications and information processing, code is a
        system of rules to convert information—such as a letter, word, sound,
        image, or gesture—into another form or representation, sometimes
        shortened or secret, for communication through a communication channel
         or storage in a storage medium.</p>
        <hr>
        <p>Register and get access to code</p>
        <a  href="" data-toggle="modal" data-target="#modalLRForm"  class="btn btn-outline-unique" rel="nofollow">Register
          <i class="fas fa-download right"></i>
        </a>
        <a href="" data-toggle="modal" data-target="#modalLRForm"  class="btn btn-unique btn-ptc"
          rel="nofollow">Log in <i class="fas fa-book right"></i></a>
      </div>
    </div>
  </div>
  <div class="container-fluid">

    <!--Section: Post-->
    <section class="jumbotron">
      <h1 class=""><strong id="headerProblemName"></strong>
            <img class="rounded-circle z-depth-1-half mt-2"
             src="assets/images/becoder.png"  id="problemHeaderUserProfilePicture" height="25px" width="25px"
            alt="Avatar">
        <span style="font-size:14px" id="problemHeaderProblemOwnerName"></span></h1>
    <hr />
        <div class="row wow fadeIn" data-wow-delay="0.2s">
            <div class="col-md-12 ">
              <div class="">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" id="problem-tab" data-toggle="tab" href="#problem" role="tab" aria-controls="problem"
                  aria-selected="true">Problems</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="submit-tab" data-toggle="tab" href="#submit" role="tab" aria-controls="submit"
                  aria-selected="false">Submit</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="mySubmission-tab" data-toggle="tab" href="#mySubmission" role="tab" aria-controls="mySubmission"
                  aria-selected="false">My Submission</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="allSubmission-tab" data-toggle="tab" href="#allSubmission" role="tab" aria-controls="allSubmission"
                  aria-selected="false">All Submission</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="standing-tab" data-toggle="tab" href="#standing" role="tab" aria-controls="standing"
                  aria-selected="false">Standing</a>
              </li>
          </ul>

          <!-- Tab Contents -->
          <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active" id="problem" role="tabpanel" aria-labelledby="problem-tab">
              <!-- gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg -->
              <hr class="extra-margins">

                <div class="container-fluid">
                <div class="row mt-3 p-3">
                      <div class="col-md-8 card grey lighten-4" style=" text-align: left !important ">

                          <blockquote class="blockquote bq-primary">
                              <h3><strong>Problem Statement: </strong></h3>
                              <div id="problemDescription">

                              </div>
                              <h3><strong>Input: </strong></h3>
                              <div id="problemInputFormate">

                              </div>
                              <h3><strong>Input Constraints: </strong></h3>
                              <div id="problemConstraints">

                              </div>
                              <h3><strong>Output: </strong></h3>
                              <div id="problemOutputFormate">

                              </div>
                              <h3 class="mb-3"><strong>Sample: </strong></h3>
                              <div id="problemInputOutputSample">
                                <h4 class="mb-3 ml-3"><strong>Input: </strong></h4>
                                <div class="ml-5" id="problemInputSample">

                                </div>
                                <h4 class="ml-3"> <strong>Output: </strong></h4>
                                <div class="ml-5" id="problemOutputSample">

                                </div>
                              </div>
                           </blockquote>

                      </div>
                      <div class="col-md-4">
                                  <div class="card card-cascade narrower">
                                      <div class="card-block">
                                          <table class="table table-borderless">
                                              <tbody>
                                                    <tr>
                                                        <td>Problem Name</td>
                                                        <td id="problemCardProblemName"></td>
                                                    </tr>
                                                    <tr>
                                                      <td>Problem Owner :</td>
                                                      <td id="problemCardProblemOwner"></td>
                                                    </tr>

                                                    <tr>
                                                      <td>Problem Participants </td>
                                                      <td id="ProblemPartiCipantsText"></td>
                                                    </tr>

                                                    <tr>
                                                      <td>Problem Solved</td>
                                                      <td id="problemSolvedText"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Language</td>
                                                        <td id="problemCardProblemLanguage">C, C++, Java, Python </td>
                                                    </tr>

                                                    <tr>
                                                        <td>Added Date</td>
                                                        <td id="problemCardProblemCreateDate">01-01-2019</td>
                                                    </tr>

                                              </tbody>
                                            </table>
                                          <a class="btn btn-primary" ripple-radius>Submit Solution</a>
                                      </div>
                                  </div>
                                  <!--/.Card-->
                      </div>


                </div>
              </div>
              <!--gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg -->

              </div>

              <div class="tab-pane fade " id="submit" role="tabpanel" aria-labelledby="submit-tab">
              <!-- Horizontal material form -->
  <form class="submit-form">
  <!-- Grid row -->

  <!-- Grid row -->

  <!-- Grid row -->
  <div class="form-group row">
  <!-- Material input -->
  <label for="problemId" class="col-sm-2 col-form-label mt-3">Language:</label>
  <select class="mdb-select md-form" id="allProblemLanguagesSubmitOption">
    <option value="" disabled selected>Choose Language</option>

  </select>
  </div>

  <!-- Grid row -->
  <div class="form-group row">
  <!-- Material input -->
  <label for="problemId" class="col-sm-2 col-form-label">Code:</label>
  <div class="form-group shadow-textarea">
  <textarea class="form-control z-depth-1" name="sourceCode" id="exampleFormControlTextarea6" rows="10"  cols="100" placeholder="Place your Code here..."></textarea>
  </div>
  </div>

  <!-- Grid row -->
  <div class="form-group row">
  <!-- Material input -->
  <label for="problemId" class="col-sm-2 col-form-label">.. or file Upload:</label>
  <div class="form-group shadow-textarea">
  <input type="file">
  </div>
  </div>
  <!-- Grid row -->
  <a href="#"><button id="submitProblemCode" type="button" class="btn btn-primary">Submit Code</button></a>

  </form>
  <!-- Horizontal material form -->
              </div>

              <div class="tab-pane fade " id="mySubmission" role="tabpanel" aria-labelledby="mySubmission-tab">
              <div class="table-responsive">
              <!--Table-->
                <table class="table table-striped">

                  <!--Table head-->
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Status</th>
                      <th>Language</th>
                      <th>Run Time</th>
                      <th>Submission Date</th>
                    </tr>
                  </thead>
                  <!--Table head-->


               <!--Table body-->
                  <tbody id="mySubmissionTableBody">

                  </tbody>
                <!--Table body-->
                </table>
              <!--Table-->
            </div>


              </div>

              <div class="tab-pane fade " id="allSubmission" role="tabpanel" aria-labelledby="allSubmission-tab">
              <div class="table-responsive">
              <!--Table-->
                <table class="table table-striped">

                  <!--Table head-->
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Status</th>
                      <th>Language</th>
                      <th>Run Time</th>
                      <th>Submission Date</th>
                      <th>Submit by</th>
                    </tr>
                  </thead>
                  <!--Table head-->


               <!--Table body-->
                  <tbody id="allSubmissionTableBody">

                  </tbody>
                <!--Table body-->
                </table>
              <!--Table-->
            </div>
              </div>

              <div class="tab-pane fade " id="standing" role="tabpanel" aria-labelledby="standing-tab">
              standing here
              </div>
          </div>
          <!-- End tab Contents -->
              </div>
          </div>
      </div>
    </section>
  </div>
  </main>
  <!--Main layout-->


  <!--Footer layout-->


  <!--End Footer Layout-->
  <footer class="page-footer text-center text-md-left mt-4 pt-4" >
    <!--Footer links-->
    <div class="container-fluid">
      <div class="row">
        <!--First column-->
        <div class="col-lg-3 col-md-6 ml-auto">
          <h5 class="title mb-3"><strong>About becoder</strong></h5>
          <p>In mathematics and computer science, an algorithm is an unambiguous
             specification of how to solve a class of problems.</p>
          <p>In mathematics and computer science, an algorithm is an unambiguous
            specification of how to solve a class of problems.</p>
        </div>
        <!--/.First column-->
        <hr class="w-100 clearfix d-sm-none">
        <!--Second column-->
        <div class="col-lg-2 col-md-6 ml-auto mb-4">
          <h5 class="title mb-3"><strong>First column</strong></h5>
          <ul class="list-unstyled">
            <li>
              <a href="#!">Link 1</a>
            </li>
            <li>
              <a href="#!">Link 2</a>
            </li>
            <li>
              <a href="#!">Link 3</a>
            </li>
            <li>
              <a href="#!">Link 4</a>
            </li>
          </ul>
        </div>
        <!--/.Second column-->
        <hr class="w-100 clearfix d-sm-none">
        <!--Third column-->
        <div class="col-lg-2 col-md-6 ml-auto mb-4">
          <h5 class="title mb-3"><strong>Second column</strong></h5>
          <ul class="list-unstyled">
            <li>
              <a href="#!">Link 1</a>
            </li>
            <li>
              <a href="#!">Link 2</a>
            </li>
            <li>
              <a href="#!">Link 3</a>
            </li>
            <li>
              <a href="#!">Link 4</a>
            </li>
          </ul>
        </div>
        <!--/.Third column-->
        <hr class="w-100 clearfix d-sm-none">
        <!--Fourth column-->
        <div class="col-lg-2 col-md-6 ml-auto mb-4">
          <h5 class="title mb-3"><strong>Third column</strong></h5>
          <ul class="list-unstyled">
            <li>
              <a href="#!">Link 1</a>
            </li>
            <li>
              <a href="#!">Link 2</a>
            </li>
            <li>
              <a href="#!">Link 3</a>
            </li>
            <li>
              <a href="#!">Link 4</a>
            </li>
          </ul>
        </div>
        <!--/.Fourth column-->
      </div>
    </div>
    <!--/.Footer links-->
    <hr>
    <!--Call to action-->
    <div class="call-to-action text-center my-4" id="footer-signin-signup-button">
      <h4 class="mb-4">Learn to code</h4>
      <h5 class="mb-4">Register and start coding</h5>
      <ul class="list-unstyled list-inline">
        <li class="list-inline-item">
          <a href="#" class="btn btn-primary waves-effect waves-light"
            rel="nofollow">Register</a>
        </li>
        <li class="list-inline-item">
          <a  href="#" class="btn btn-info waves-effect waves-light"
            rel="nofollow">Log in</a>
        </li>
      </ul>
    </div>
    <!--/.Call to action-->

    <!--Copyright-->
    <div class="footer-copyright py-3 text-center">
      <div class="containter-fluid">
        © 2019 Copyright: <a href="index.html"> becoder.com </a>
      </div>
    </div>
    <!--/.Copyright-->
  </footer>
  <!--/.Footer-->
  <script>
  new WOW().init();
  </script>
<script type="text/javascript" src="bin/becoder.js"></script>
<script>
"use strict";
// Checks that Firebase has been imported.
checkSetup();
console.log(firebase.auth().currentUser+"jfhjsh ");
var problemIdRef ;
var signInButtonElement = document.getElementById('google_login');

var userSignUpEmail = document.getElementById('user-sign-up-email');
var userSignUpPass = document.getElementById('user-sign-up-password');
var userSignUpUsername = document.getElementById('user-sign-up-username');

var signUpWithEmailPasswordButton = document.getElementById('sign-up-with-email');
var signInWithEmailPasswordButton = document.getElementById('sign-in-with-email');
var signInSignUpJumborton = document.getElementById('sign-in-sign-up-jumbotron');
var signInSignUpNavButton = document.getElementById('navbar-login-signin-button');
var footerSigninSignupButton = document.getElementById('footer-signin-signup-button');
var logoutButton = document.getElementById('logout');
var userNavItem = document.getElementById('navbar-user-item');
var userNavName = document.getElementById('nav-user-name');
var userNavPic = document.getElementById('nav-user-pic');

signInButtonElement.addEventListener('click', signIn);
signUpWithEmailPasswordButton.addEventListener('click',signUpWithEmailPassword);
signInWithEmailPasswordButton.addEventListener('click',signInWithEmailPassword);
logoutButton.addEventListener('click',signOut);

$(document).ready(function(){
  var queryString = decodeURIComponent(window.location.search);
  problemIdRef = queryString.substring(1);
  initFirebaseAuthWithSpecificProblemDetails(true,problemIdRef);
});

function getAllProblemLanguagesForSubmitOption(problemIdRef){
  firestore.collection('problemsTest').doc(problemIdRef)
  .collection("problemLanguages")
  .where('languageCheck', '==', true)
  .orderBy("languageId")
  .onSnapshot(function(snapshot) {
    $("#allProblemLanguagesSubmitOption").empty();
    snapshot.forEach(function(doc) {
      var data = doc.data();
      var optionLang = '<option value="'+data.languageId+'">\
      '+data.languageName+'</option>';
      console.log(optionLang);
      $("#allProblemLanguagesSubmitOption").append(optionLang);
    });
    }, function(error) {
        console.log(error);
    });
}

function getMySubmissionAll(problemIdRef){
    firestore.collection('problemsTest').doc(problemIdRef)
    .collection("submissions")
    .where('submitBy', '==', getCurrentUserId())
    .orderBy("submissionTime","desc")
    .onSnapshot(function(snapshot) {
      $("#mySubmissionTableBody").empty();
      var count = 1;
      snapshot.forEach(function(doc) {
        console.log(doc.data());
        var data = doc.data();
        var submissionStatus = data.status;
        var submissionStatusID = submissionStatus.id;
        var submissionBadegeClass ;
        var runTime ;
        if (submissionStatusID==3) {
          submissionBadegeClass = "badge-default";
          runTime = data.time;
        }
        else if (submissionStatusID==4) {
          submissionBadegeClass = "badge-danger";
          runTime = data.time;
        }
        else  {
          submissionBadegeClass =  "badge-warning";
          runTime ='<span class="badge badge-warning">\
          <i class="fas fa-times"></i></span>';

        }
          console.log(data.status.id);
          // doc.data() is never undefined for query doc snapshots
          var mySubmissionRow = '<tr>\
             <th scope="row">'+count+'</th>\
             <td>\
              <h5>\
              <span class="badge badge-pill '+submissionBadegeClass+'">'+submissionStatus.description+'</span>\
              </h5>\
              </td>\
             <td>'+data.languageName+'</td>\
             <td>'+runTime+'</td>\
             <td>'+timeConverterUnixTOString(data.submissionTime)+'</td>\
         </tr>';

          $("#mySubmissionTableBody").append(mySubmissionRow);
          count++;
      });
       }, function(error) {
         console.log("Error getting documents: ", error);
       });


}

function getAllSubmission(problemIdRef){
    firestore.collection('problemsTest').doc(problemIdRef)
    .collection("submissions").orderBy("submissionTime","desc")
    .onSnapshot(function(snapshot) {
      $("#allSubmissionTableBody").empty();
      var count = 1;
      snapshot.forEach(function(doc) {
        console.log(doc.data());
        var data = doc.data();
        var submissionStatus = data.status;
        var submissionStatusID = submissionStatus.id;
        var submissionBadegeClass ;
        var runTime ;
        if (submissionStatusID==3) {
          submissionBadegeClass = "badge-default";
          runTime = data.time;
        }
        else if (submissionStatusID==4) {
          submissionBadegeClass = "badge-danger";
          runTime = data.time;
        }
        else  {
          submissionBadegeClass =  "badge-warning";
          runTime ='<span class="badge badge-warning">\
          <i class="fas fa-times"></i></span>';

        }
          console.log(data.status.id);
          // doc.data() is never undefined for query doc snapshots
          var mySubmissionRow = '<tr>\
             <th scope="row">'+count+'</th>\
             <td>\
              <h5>\
              <span class="badge badge-pill '+submissionBadegeClass+'">'+submissionStatus.description+'</span>\
              </h5>\
              </td>\
             <td>'+data.languageName+'</td>\
             <td>'+runTime+'</td>\
             <td>'+timeConverterUnixTOString(data.submissionTime)+'</td>\
             <td>'+data.submitAuthorName+'</td>\
         </tr>';

          $("#allSubmissionTableBody").append(mySubmissionRow);
          count++;
      });

       }, function(error) {
         console.log("Error getting documents: ", error);
       });

}


function timeConverterUnixTOString(UNIX_timestamp){
  var a = new Date(UNIX_timestamp);
  var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  var year = a.getFullYear();
  var month = months[a.getMonth()];
  var date = a.getDate();
  var hour = a.getHours();
  var min = a.getMinutes();
  var sec = a.getSeconds();
  var time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec ;
  return time;
}
function getProblemDetailsForCompete(problemIdRef){
  var docRef = firestore.collection("problemsTest").doc(problemIdRef);
  docRef.get().then(function(doc) {
      if (doc.exists) {
        var data = doc.data();
        var pName = data.problemName;
        var pDet = data.problemStatement;
        var pOwnerName =data.problemAuthorName;
        var pConstraints = data.problemConstraints;
        var pInputFormat = data.inputFormate;
        var pOutPutFormat = data.outputFormate
        var pParticipants = data.participants;
        var pSolved =  data.problemSolved;
        var pCreateDate = data.problemCreateDate;
        var pAuthorProfilePic = data.problemAuthorProfilePicture;

        $("#headerProblemName").text(pName);
        $("#problemHeaderUserProfilePicture").attr('src',pAuthorProfilePic);
        $("#problemHeaderProblemOwnerName").text(pOwnerName);
        $("#problemDescription").html(pDet);
        $("#problemInputFormate").html(pInputFormat);
        $("#problemConstraints").html(pConstraints);
        $("#problemOutputFormate").html(pOutPutFormat);

        $("#problemCardProblemName").text(pName);
        $("#problemCardProblemOwner").text(pOwnerName);
        $("#ProblemPartiCipantsText").text(pParticipants);
        $("#problemSolvedText").text(pSolved);
        $("#problemCardProblemLanguage").text();
        $("#problemCardProblemCreateDate").text(timeConverterUnixTOString(pCreateDate));

          console.log("Document data:", doc.data());
      } else {
          // doc.data() will be undefined in this case
          console.log("No such document!");
      }
  }).catch(function(error) {
        console.log("Error getting document:", error);
  });

      firestore.collection("problemsTest").doc(problemIdRef).collection("problemTestCases").where('sample', '==', true).get()
      .then(function(querySnapshot) {
          querySnapshot.forEach(function(doc) {
            var data = doc.data();
              // doc.data() is never undefined for query doc snapshots
              console.log(doc.id, " => ", doc.data());
              $("#problemInputSample").text(data.testCaseInput);
              $("#problemOutputSample").text(data.testCaseOutput);

          });
      })
      .catch(function(error) {
          console.log("Error getting documents: ", error);
      });


}
</script>
<script>
  var stopFetch = false;
  var counterForJudge = 1;
  var isFinishedAllTestCaseJudge = false;
  var stopUpdateToFirestore = false;
  var snapSize;
  if (window.location.protocol !== "file:") {
    $("input[name=apiUrl]").attr('value', window.location.origin);
  }

  function createQueryParameters(type = "Request") {
    var parameters = [];
    parameters.push("base64_encoded=true");

    parameters.push("wait=false");

    if (parameters.length == 0) {
      return "";
    }

    var queryParameters = "?";
    for (var i = 0; i < parameters.length - 1; i++) {
      queryParameters += parameters[i] + "&";
    }

    return queryParameters + parameters[parameters.length - 1];
  }

  function resetButtons() {
    stopFetch = false;
    $("#submitProblemCode").removeAttr("disabled");
    // $("#stop").prop("disabled", true);
    // $("#panel").css('background-color', '#00F20D');
  }



  function handleError(jqXHR, textStatus, errorThrown) {
    resetButtons();
  }

  function fetchSubmission(apiUrl, token,testtags,languageId,languageName) {
    var queryParameters = createQueryParameters("Response");
    console.log("token "+token);

    $.ajax({
      url: apiUrl + "/submissions/" + token + queryParameters,
      type: "GET",
      async: true,
      success: function(data, textStatus, jqXHR) {
        console.log(textStatus);

        if ((data.status === undefined || data.status.id <= 2) && (data.status_id === undefined || data.status_id <= 2) && !stopFetch) {
          setTimeout(fetchSubmission.bind(null, apiUrl, token,testtags,languageId,languageName), 1500);
        } else if (!stopFetch) {
          console.log(data);
          if(stopUpdateToFirestore==false){
            data.testCaseId = testtags;
            data.languageId = languageId;
            data.languageName = languageName;
            data.submitBy = getCurrentUserId();
            data.submitAuthorName = getUserName();

            if ((data.status.description != "Accepted")){
              console.log(data+"bipul d");
              data.submissionTime = Date.parse(new Date());
              console.log(testtags);;
                firestore.collection("problemsTest").doc(problemIdRef).collection("submissions").add(data)
                .then(function(docRef) {
                    console.log("Document written with ID bipulsd: ", docRef.id);
                })
                .catch(function(error) {
                    console.error("Error adding document: ", error);
                });
             stopUpdateToFirestore = true;
             resetButtons();
           }
           console.log(counterForJudge + " " +snapSize);
            if(counterForJudge == snapSize){

              console.log(data+"bipul d");
              data.submissionTime = Date.parse(new Date());
                console.log(testtags);;

                firestore.collection("problemsTest").doc(problemIdRef).collection("submissions").add(data)
                .then(function(docRef) {
                    console.log("Document written with ID bipulsd: ", docRef.id);
                })
                .catch(function(error) {
                    console.error("Error adding document: ", error);
                });
             stopUpdateToFirestore = true;
             resetButtons();
           }
          }
         counterForJudge += 1;
        } else {
          resetButtons();
        }
      },
      error: handleError
    });
  }

  $("#submitProblemCode").click(function() {
    $(this).prop("disabled", true);
    // $("#stop").removeAttr("disabled");
    $("#panel").css('background-color', '#F2000D');

    var apiUrl = " https://api.judge0.com";
    var sourceCode = $("textarea[name=sourceCode]").val();
    // var languageId = $("input[name=languageId]").val();
    counterForJudge = 1;
    stopUpdateToFirestore = false;


    firestore.collection("problemsTest").doc(problemIdRef).collection("problemTestCases")
    .get()
    .then(function(querySnapshot) {
        snapSize = querySnapshot.size;
        console.log(snapSize);
        var languageId = $('#allProblemLanguagesSubmitOption').find(":selected").val();
        var languageName = $('#allProblemLanguagesSubmitOption').find(":selected").text();
        querySnapshot.forEach(function(doc) {
            // doc.data() is never undefined for query doc snapshots
            if (stopUpdateToFirestore!=true) {
              var srcC = sourceCode;
              var numberOfRuns;
              var stdin ;
              var expectedOutput ;
              var cpuTimeLimit ;
              var cpuExtraTime ;
              var wallTimeLimit ;
              var memoryLimit ;
              var stackLimit ;
              var maxProcessesAndOrThreads ;
              var enablePerProcessAndThreadTimeLimit ;
              var enablePerProcessAndThreadMemoryLimit ;
              var maxFileSize =null;
              var wait = false;

              numberOfRuns = null;
              cpuTimeLimit = null;
              cpuExtraTime = null;
              wallTimeLimit = null;
              memoryLimit = null;
              stackLimit = null;

              maxProcessesAndOrThreads = null;
              enablePerProcessAndThreadTimeLimit = null;
              enablePerProcessAndThreadMemoryLimit = null;
              maxFileSize = null;

              var queryParameters = createQueryParameters();
              var firestoreData = doc.data();
              console.log(firestoreData);
              var testtags = firestoreData.testCaseTag;
              console.log(testtags+"hey bipul");
              console.log(firestoreData.testCaseInput+" "+firestoreData.testCaseOutput);
              stdin = btoa(firestoreData.testCaseInput);
              expectedOutput = btoa(firestoreData.testCaseOutput);


              var data = {
                source_code: btoa(srcC),
                language_id: languageId,
                number_of_runs: numberOfRuns,
                stdin: stdin,
                expected_output: expectedOutput,
                cpu_time_limit: cpuTimeLimit,
                cpu_extra_time: cpuExtraTime,
                wall_time_limit: wallTimeLimit,
                memory_limit: memoryLimit,
                stack_limit: stackLimit,
                max_processes_and_or_threads: maxProcessesAndOrThreads,
                enable_per_process_and_thread_time_limit: enablePerProcessAndThreadTimeLimit,
                enable_per_process_and_thread_memory_limit: enablePerProcessAndThreadMemoryLimit,
                max_file_size: maxFileSize
              };


              $.ajax({
                url: apiUrl + "/submissions" + queryParameters,
                type: "POST",
                async: true,
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function(data, textStatus, jqXHR) {

                  if (!wait) {
                    console.log("token "+data.token);

                    setTimeout(fetchSubmission.bind(null, apiUrl, data.token,testtags,languageId,languageName), 1500);
                  } else {

                    resetButtons();
                  }
                },
                error: handleError
              });

            console.log(doc.id, " => ", doc.data());

            }

        });
    })
    .catch(function(error) {
        console.log("Error getting documents: ", error);
    });


  });

  // $("#stop").click(function() {
  //   stopFetch = true;
  // });

</script>
</body>

</html>
